<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="EVERYTHING YOU NEED FOR DEVELOPMENT">

    <title>Realm과 MVP 예제 - Jungwoon Blog</title>

    <link rel="canonical" href="http://localhost:4000/android/2017/03/08/Realm-MVP-Pattern-Practice/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Jungwoon Blog" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jungwoon Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
				
                <li>
                    <a href="/about/">About</a>
                </li>
				
                
				
                <li>
                    <a href="/contact/">Contact</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Realm과 MVP 예제</h1>
                    
                    <span class="meta">Posted by Jungwoon Blog on March 8, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h2 id="realm과-mvp-pattern을-활용한-간단한-예제">Realm과 MVP Pattern을 활용한 간단한 예제</h2>
<p>자세한 예제는 <a href="https://github.com/Jungwoon/Realm_MVP_Pattern_Practice">Github</a>에서 확인할 수 있습니다.</p>

<p><img src="https://cdn-images-1.medium.com/max/600/1*qidJtSglIxtkk-OH3qgctg.png" alt="img" />
<img src="https://cdn-images-1.medium.com/max/600/1*chdkcuqzHPhB5fQCnsefcA.png" alt="img" />
<img src="https://cdn-images-1.medium.com/max/1200/1*41or-U9fBSqWWR16s_Rm6g.png" alt="img" />
<img src="https://cdn-images-1.medium.com/max/1200/1*nMKpm96BJzoNqG95U0lZqQ.png" alt="img" /></p>

<h3 id="realm-부분">Realm 부분</h3>

<h4 id="model을-만들어-schema-정의">Model을 만들어 Schema 정의</h4>
<p>Realm에서 Schema를 지정해주는 부분 RealmObject로부터 상속을 받아서, 사용할 Schema를 지정해줍니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="nd">@PrimaryKey</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">department</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">salary</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getIndex</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">index</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDepartment</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">department</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDepartment</span><span class="o">(</span><span class="n">String</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSalary</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">salary</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSalary</span><span class="o">(</span><span class="kt">int</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">salary</span> <span class="o">=</span> <span class="n">salary</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<h4 id="dbhelper를-통해-입력-수정-및-삭제">DBHelper를 통해 입력, 수정 및 삭제</h4>
<p>DBHelper를 Singleton 으로 구성해서 좀 더 쉽게 접근하게끔 만들어 줌</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBHelper</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">DBHelper</span> <span class="n">ourInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DBHelper</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DBHelper</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ourInstance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">Realm</span> <span class="n">realm</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">DBHelper</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Realm</span> <span class="nf">getRealmInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">realm</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 새로 추가하는 부분</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertMember</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">department</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>

        <span class="n">member</span><span class="o">.</span><span class="na">setIndex</span><span class="o">(</span><span class="n">getAutoIncrementIndex</span><span class="o">(</span><span class="n">member</span><span class="o">));</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">department</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setSalary</span><span class="o">(</span><span class="n">salary</span><span class="o">);</span>

        <span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">copyToRealm</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="c1">// 현제 테이블에 있는 모든 Member를 리스트로 받는 부분</span>
    <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">MemberItem</span><span class="o">&gt;</span> <span class="nf">getMembers</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">().</span><span class="na">sort</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="n">Sort</span><span class="o">.</span><span class="na">DESCENDING</span><span class="o">);</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">MemberItem</span><span class="o">&gt;</span> <span class="n">memberItems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// 질의한 결과를 RecyclerView에서 이용할 수 있도록 arrayList에 넣어주는 부분</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">members</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">memberItems</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">MemberItem</span><span class="o">(</span>
                    <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getIndex</span><span class="o">(),</span>
                    <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getName</span><span class="o">(),</span>
                    <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getDepartment</span><span class="o">(),</span>
                    <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getTitle</span><span class="o">(),</span>
                    <span class="n">members</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getSalary</span><span class="o">()</span>
            <span class="o">));</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">memberItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">getMemberWithIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="n">index</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// index에 해당하는 정보를 변경</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">editMemberWithIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">department</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getMemberWithIndex</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

        <span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">department</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setSalary</span><span class="o">(</span><span class="n">salary</span><span class="o">);</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="c1">// index 값을 받아서 해당하는 member를 삭제</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteMemberWithIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getMemberWithIndex</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">deleteAllFromRealm</span><span class="o">();</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNewMemberIndex</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">getAutoIncrementIndex</span><span class="o">(</span><span class="k">new</span> <span class="n">Member</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// Realm에 Autoincrement가 없기 때문에 수동으로 처리해주는 부분</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">getAutoIncrementIndex</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">nextIndex</span><span class="o">;</span>
        <span class="n">Number</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// 질의 부분에서 instance를 확인하여 들어가는 부분</span>
        <span class="c1">// index에서 가장 큰 값을 구해서, 1을 더해준다.</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="k">instanceof</span> <span class="n">Member</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">currentIndex</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">max</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">currentIndex</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">nextIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">nextIndex</span> <span class="o">=</span> <span class="n">currentIndex</span><span class="o">.</span><span class="na">intValue</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">nextIndex</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre>
</div>
<h4 id="tips">Tips</h4>
<p>Realm에서는 Auto Increment가 없기 때문에 아래 소스와 같이 별도의 함수를 만들어서 처리
해당 모델의 인스턴스를 확인한 후 그걸 이용해서 가장 큰 index를 받아와 1을 더해서 반환</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Realm에 Auto Increment가 없기 때문에 수동으로 처리해주는 부분</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="nf">getAutoIncrementIndex</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">nextIndex</span><span class="o">;</span>
    <span class="n">Number</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="c1">// 질의 부분에서 instance를 확인하여 들어가는 부분</span>
    <span class="c1">// index에서 가장 큰 값을 구해서, 1을 더해준다.</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="k">instanceof</span> <span class="n">Member</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">currentIndex</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">max</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">currentIndex</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">nextIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="n">nextIndex</span> <span class="o">=</span> <span class="n">currentIndex</span><span class="o">.</span><span class="na">intValue</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">nextIndex</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="mvp-pattern">MVP Pattern</h3>
<p>최근에 Design Pattern에 관심을 가지면서, 많이 부족하지만 꿈 많은 개발자로 활동하시는 김태환님의 <a href="http://thdev.tech/androiddev/2016/10/12/Android-MVP-Intro.html">블로그</a>를 참고하여 만들었습니다.</p>

<h4 id="구성">구성</h4>
<p><img src="https://cdn-images-1.medium.com/max/1200/1*Gy9MEiv55PrZK3Jf6kx93w.png" alt="img" /></p>

<h4 id="maincontract">MainContract</h4>
<p>메인이 되는 Contract 부분을 Interface로 정의하여, Presenter와 MainActivity에서 implements 받아 사용합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MainContract</span> <span class="o">{</span>

    <span class="kd">interface</span> <span class="nc">View</span> <span class="o">{</span>

        <span class="kt">void</span> <span class="nf">showToast</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">interface</span> <span class="nc">Presenter</span> <span class="o">{</span>

        <span class="kt">void</span> <span class="nf">setMyAdapterView</span><span class="o">(</span><span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">View</span> <span class="n">adapterView</span><span class="o">);</span>

        <span class="kt">void</span> <span class="nf">setMyAdapterModel</span><span class="o">(</span><span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">Model</span> <span class="n">adapterModel</span><span class="o">);</span>

        <span class="kt">void</span> <span class="nf">attachView</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">);</span>

        <span class="kt">void</span> <span class="nf">detachView</span><span class="o">();</span>

        <span class="kt">void</span> <span class="nf">loadItems</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isClear</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<h4 id="mainpresenter">MainPresenter</h4>
<p>중간에서 모든 역할을 다 하는 Presenter를 정의해주는 소스, View에서 요청을 받아, Model로부터 데이터를 받아 처리하고 다시 View에 뿌려주는 역할을 합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPresenter</span> <span class="kd">implements</span> <span class="n">MainContract</span><span class="o">.</span><span class="na">Presenter</span><span class="o">,</span> <span class="n">OnItemClickListener</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">MainContract</span><span class="o">.</span><span class="na">View</span> <span class="n">view</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">View</span> <span class="n">adapterView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">Model</span> <span class="n">adapterModel</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMyAdapterView</span><span class="o">(</span><span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">View</span> <span class="n">adapterView</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">adapterView</span> <span class="o">=</span> <span class="n">adapterView</span><span class="o">;</span>

        <span class="k">this</span><span class="o">.</span><span class="na">adapterView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMyAdapterModel</span><span class="o">(</span><span class="n">MyAdapterContract</span><span class="o">.</span><span class="na">Model</span> <span class="n">adapterModel</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">adapterModel</span> <span class="o">=</span> <span class="n">adapterModel</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attachView</span><span class="o">(</span><span class="n">MainContract</span><span class="o">.</span><span class="na">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">detachView</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadItems</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isClear</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 이미</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">MemberItem</span><span class="o">&gt;</span> <span class="n">memberItems</span> <span class="o">=</span> <span class="n">DBHelper</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getMembers</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">isClear</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">adapterModel</span><span class="o">.</span><span class="na">clearItems</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">adapterModel</span><span class="o">.</span><span class="na">addItems</span><span class="o">(</span><span class="n">memberItems</span><span class="o">);</span>
        <span class="n">adapterView</span><span class="o">.</span><span class="na">notifyAdapter</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MemberItem</span> <span class="n">memberItem</span> <span class="o">=</span> <span class="n">adapterModel</span><span class="o">.</span><span class="na">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="n">memberItem</span><span class="o">.</span><span class="na">getIndex</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<h4 id="adaptercontract">AdapterContract</h4>
<p>Adapter 자체도 별도의 MVP패턴으로 처리해주기 위해서 AdapterContract을 정의하여 사용</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyAdapterContract</span> <span class="o">{</span>

    <span class="kd">interface</span> <span class="nc">View</span> <span class="o">{</span>

        <span class="kt">void</span> <span class="nf">setOnClickListener</span><span class="o">(</span><span class="n">OnItemClickListener</span> <span class="n">onClickListener</span><span class="o">);</span>

        <span class="kt">void</span> <span class="nf">notifyAdapter</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">interface</span> <span class="nc">Model</span> <span class="o">{</span>

        <span class="kt">void</span> <span class="nf">addItems</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">MemberItem</span><span class="o">&gt;</span> <span class="n">memberItems</span><span class="o">);</span>

        <span class="kt">void</span> <span class="nf">clearItems</span><span class="o">();</span>

        <span class="n">MemberItem</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<p>자세한 소스는 위쪽에 정의한 링크를 확인하면 전체 소스를 확인할 수 있습니다.
관련해서, 잘못된 부분이나 틀린 부분있으면 Comment 달아주시면 수정하도록 하겠습니다.</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/android/2017/02/27/AVD-Error/" data-toggle="tooltip" data-placement="top" title="'initial hax sync failed' 라고 뜨면서 AVD 실행되지 않을때">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/bigdata/2017/03/23/HADOOP-SETUP-EC2/" data-toggle="tooltip" data-placement="top" title="AWS EC2에 Hadoop 설치하기">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/byPJW">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/byjw.park">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/jungwoon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:byjungwoon@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Your/Project/Corporate Name 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    


</body>

</html>
