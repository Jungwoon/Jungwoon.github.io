<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="EVERYTHING YOU NEED FOR DEVELOPMENT">

    <title>Realm 훑어보기 - Jungwoon Blog</title>

    <link rel="canonical" href="http://localhost:4000/android/2017/02/19/Realm-Review/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Jungwoon Blog" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jungwoon Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
				
                <li>
                    <a href="/about/">About</a>
                </li>
				
                
				
                <li>
                    <a href="/contact/">Contact</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Realm 훑어보기</h1>
                    
                    <span class="meta">Posted by Jungwoon Blog on February 19, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1 id="realm-정리">Realm 정리</h1>
<p>다음 내용들은 Realm 홈페이지의 내용들을 정리한 내용입니다.</p>

<p><a href="https://realm.io/kr/">Realm 페이지</a></p>

<h2 id="realm">Realm</h2>
<p>Realm을 사용하기 전에 먼저 Realm을 초기화하여야 합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Realm</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</code></pre>
</div>

<p>Realm을 초기화하기 가장 좋은 곳은 어플리케이션 서브 클래스의 onCreate() 입니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
    <span class="n">Realm</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="realm-설정하기">Realm 설정하기</h3>
<p>Realm을 어떻게 생성하는지 모든 측면을 제어하기 위해 RealmConfiguration 객체를 사용합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// RealmConfiguration은 빌더 패턴에 의해 생성됩니다.</span>
<span class="c1">// Realm 파일은 Context.getFilesDir()에 위치하면 이름은 "myrealm.realm"입니다.</span>
<span class="n">RealmConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealmConfiguration</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"myrealm.realm"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">encryptionKey</span><span class="o">(</span><span class="n">getKey</span><span class="o">())</span>
  <span class="o">.</span><span class="na">schemaVersion</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
  <span class="o">.</span><span class="na">modules</span><span class="o">(</span><span class="k">new</span> <span class="n">MySchemaModule</span><span class="o">())</span>
  <span class="o">.</span><span class="na">migration</span><span class="o">(</span><span class="k">new</span> <span class="n">MyMigration</span><span class="o">())</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="c1">// 설정을 사용합니다.</span>
<span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="realm의-절대-경로-얻기">Realm의 절대 경로 얻기</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Realm</span><span class="o">.</span><span class="na">getPath</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="기본-realmconfiguration">기본 RealmConfiguration</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
    <span class="c1">// Context.getFilesDir()에 "default.realm"란 이름으로 Realm 파일이 위치한다</span>
    <span class="n">Realm</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">RealmConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealmConfiguration</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="n">Realm</span><span class="o">.</span><span class="na">setDefaultConfiguration</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
    <span class="c1">// ... 무엇을 합니다 ...</span>
    <span class="n">realm</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="in-memory-realm">In-memory Realm</h3>
<p>아래와 같이 설정하면 디스크에 저장하지 않는 인 메모리 Realm이 생성됩니다. 인 메모리 Realm은 메모리가 부족하면 여전히 디스크를 이용합니다. 하지만 모든 파일들은 메모리 상에서 생성되고 Realm이 닫히면 삭제됩니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmConfiguration</span> <span class="n">myConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealmConfiguration</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"myrealm.realm"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">inMemory</span><span class="o">()</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="realm-객체-닫기">Realm 객체 닫기</h3>
<p>Realm은 Native Memory Release와 File Descriptor를 다루기 위해 Closeable을 구현합니다.</p>

<p>Realm 인스턴스는 레퍼런스 카운티잉 되기 때문 getInstance()를 두 번 호출하면 사용이 끝난 후에도 close()를 두 번 해주어야 합니다.</p>

<p>UI Thread</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
	<span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
	<span class="n">realm</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Thread</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Realm 인스턴스와 비 Looper 스레드를 실행합니다.</span>
<span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// ... Realm 인스턴스를 사용합니다 ...</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">realm</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre>
</div>

<h2 id="모델">모델</h2>

<h3 id="생성방법">생성방법</h3>
<p>모델은 RealmObject 에서 상속을 받아 생성합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span>          <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span>             <span class="n">age</span><span class="o">;</span>

    <span class="nd">@Ignore</span>
    <span class="kd">private</span> <span class="kt">int</span>             <span class="n">sessionId</span><span class="o">;</span>

    <span class="c1">// IDE에 의해 생성된 표준 게터와 세터들...</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span>    <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span>    <span class="nf">getSessionId</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">sessionId</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setSessionId</span><span class="o">(</span><span class="kt">int</span> <span class="n">sessionId</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">sessionId</span> <span class="o">=</span> <span class="n">sessionId</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="required">@Required</h3>
<p>null 값을 허용하지 않음, 기본형과 RealmList 형에 대한 필드들은 암묵적으로 Required로 취급됩니다. RealmObject 형의 필드들은 항상 null이 가능</p>

<h3 id="ignore">@Ignore</h3>
<p>필드가 디스크에 저장되지 않도록 하는 어노테이션으로, 보통 쓰지 않을 데이터 필드를 다루는 특별 케이스를 만들때 유용합니다.</p>

<h3 id="자동-갱신-객체">자동 갱신 객체</h3>
<p>Realm 객체와 RealmResults 는 기반 데이터에 의해 라이브로 자동 갱신되는 뷰입니다. 즉 결과를 매번 가져오지 않아도 되게 됩니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Dog</span> <span class="n">myDog</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">myDog</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Fido"</span><span class="o">);</span>
        <span class="n">myDog</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
<span class="n">Dog</span> <span class="n">myDog</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">findFirst</span><span class="o">();</span>

<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Dog</span> <span class="n">myPuppy</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">findFirst</span><span class="o">();</span>
        <span class="n">myPuppy</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h3 id="index">@Index</h3>
<p>해당 필드에 검색 색인을 추가하여, 데이터의 크기는 커지지만, 질의 처리를 빠르게 할 수 있습니다.</p>

<h3 id="primarykey">@PrimaryKey</h3>
<p>필드를 기본키로 다루기 위해서, 사용해야 하며, 필드 타입에는 문자열, 정수나, 박스형이어야 합니다. 여러 필드를 기본키로 이용할 수 없으며, 문자열을 기본키로 사용하면 해당 필드는 인덱싱 됩니다.(@PrimaryKey 어노테이션은 암묵적으로 @Index 어노테이션을 설정합니다.)</p>

<h3 id="createorupdate">createOrUpdate()</h3>
<p>객체를 생성하거나 수정할 수 있으며, 기본키가 없으면 새 객체를 생성하고, 이미 있다면 수정됩니다.</p>

<h3 id="realmcreateobject">Realm.createObject()</h3>
<p>모든 필드가 기본 값으로 설정된 새로운 객체를 얻습니다. 이 경우 기본 키가 기본 값으로 설정이 되어 기존 객체와 충돌할 수 있습니다. 이 것을 막기 위해 비관리 객체를 만들어 값을 설정한 후 copyToRealm()를 통해 Realm으로 복사하는 것을 권장합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">final</span> <span class="n">MyObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyObject</span><span class="o">();</span>
<span class="n">obj</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
<span class="n">obj</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Fish"</span><span class="o">);</span>
<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 이것은 Realm의 새 클래스를 만들거나 이미 객체가 있다면 예외를 던집니다.</span>
        <span class="c1">// (동일한 기본 키)</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">copyToRealm</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>

        <span class="c1">// 이는 같은 기본 키가 있다면 기존 객체를 갱신하거나</span>
        <span class="c1">// 기본 키 = 42인 객체가 없다면 새로운 객체를 만듭니다</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">copyToRealmOrUpdate</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h2 id="관계">관계</h2>

<h3 id="realm에서의-관계">Realm에서의 관계</h3>
<p>모든 RealmObject는 같이 연결할 수 있습니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Email</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>
    <span class="c1">// ... 세터와 게터들이 위치합니다</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Email</span> <span class="n">email</span><span class="o">;</span> <span class="c1">// 위에서 선언한 RealmObject</span>
    <span class="c1">// ... 세터와 게터들이 위치합니다</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="다-vs-다">다 VS 다</h3>
<p>RealmList<T> 필드를 이용해다대다 1:N, N:N 관게를 만들 수 있습니다.</T></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">RealmList</span><span class="o">&lt;</span><span class="n">Email</span><span class="o">&gt;</span> <span class="n">emails</span><span class="o">;</span> <span class="c1">// 여러개의 메일</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Email</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>객체들을 만들고 Email 객체들을 Contact 객체에 추가하기 위해 RealmList.add()를 사용할 수 있습니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">Contact</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">contact</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">"John Doe"</span><span class="o">;</span>

        <span class="n">Email</span> <span class="n">email1</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">Email</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">email1</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="s">"john@example.com"</span><span class="o">;</span>
        <span class="n">email1</span><span class="o">.</span><span class="na">active</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">contact</span><span class="o">.</span><span class="na">emails</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">email1</span><span class="o">);</span>

        <span class="n">Email</span> <span class="n">email2</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">Email</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">email2</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="s">"jd@example.com"</span><span class="o">;</span>
        <span class="n">email2</span><span class="o">.</span><span class="na">active</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">contact</span><span class="o">.</span><span class="na">emails</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">email2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h2 id="쓰기">쓰기</h2>

<h3 id="commit">Commit</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
<span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="c1">// 이 안에서 객체를 추가하거나 갱신합니다.</span>
<span class="c1">// ex) User user = realm.createObject(User.class);</span>

<span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="cancel">Cancel</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="c1">// 이 안에서 객체를 추가하거나 갱신합니다.</span>
<span class="c1">// ex) User user = realm.createObject(User.class);</span>

<span class="n">realm</span><span class="o">.</span><span class="na">cancelTransaction</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="객체-만들기-1-realm을-통해-직접-인스턴스-생성-방법">객체 만들기 #1 (Realm을 통해 직접 인스턴스 생성 방법)</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// 새 객체 만들기</span>
<span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
<span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"john@corporation.com"</span><span class="o">);</span>
<span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="객체-만들기-2-인스턴스를-생성하고-나중에-추가하는-방법">객체 만들기 #2 (인스턴스를 생성하고 나중에 추가하는 방법)</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
<span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"john@corporation.com"</span><span class="o">);</span>

<span class="c1">// 객체를 Realm으로 복사하기, 어떤 추가적인 변경도 realmUser에 있을 수 있습니다.</span>
<span class="n">realm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="n">User</span> <span class="n">realmUser</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">copytoRealm</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
<span class="n">realm</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="트랜잭션-블록">트랜잭션 블록</h3>
<p>beginTransaction(), commitTransaction(), cancelTransaction()을 관리하는대신에 자동으로 begin/commit 하는 방법</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
		<span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"john@corporation.com"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h3 id="비동기-트랜잭션">비동기 트랜잭션</h3>
<p>트랜잭션이 다른 트랜잭션들에 의해 블록되기 때문에, 백그라운드에서 모든 쓰기 작업을 하는 방법</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">realm</span><span class="o">.</span><span class="na">executeTransactionAsync</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">bgRealm</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">bgRealm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
                <span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"john@corporation.com"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">.</span><span class="na">OnSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">// Transaction was a success.</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">.</span><span class="na">OnError</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Transaction failed and was automatically canceled.</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre>
</div>

<p>비동기 트랜잭션인 RealmAsyncTask 객체는 트랜잭션이 끝나기 전에, 액티비티나, 프래그먼트를 끝내야 할 때 대기중인 트랜잭션을 취소하기 위해서도 사용</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span> <span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">transaction</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">transaction</span><span class="o">.</span><span class="na">isCancelled</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">transaction</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="질의">질의</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>(질의와 속성 접근을 포함한) 모든 질의는 바로 처리되지 않습니다. 속성에 접근할 때에만 데이터를 읽습니다.
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>

    <span class="nd">@PrimaryKey</span>
    <span class="kd">private</span> <span class="n">String</span>          <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span>             <span class="n">age</span><span class="o">;</span>

    <span class="nd">@Ignore</span>
    <span class="kd">private</span> <span class="kt">int</span>             <span class="n">sessionId</span><span class="o">;</span>

    <span class="c1">// IDE에서 생성된 표준 게터와 세터들...</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span>    <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span>    <span class="nf">getSessionId</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">sessionId</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span>   <span class="nf">setSessionId</span><span class="o">(</span><span class="kt">int</span> <span class="n">sessionId</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">sessionId</span> <span class="o">=</span> <span class="n">sessionId</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Build the query looking at all users:</span>
<span class="n">RealmQuery</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// 질의 조건을 추가합니다</span>
<span class="n">query</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">or</span><span class="o">().</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Peter"</span><span class="o">);</span>

<span class="c1">// 질의를 수행합니다</span>
<span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>

<span class="c1">// 같은 일들을 한번에 합니다 ("Fluent interface"):</span>
<span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                                  <span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
                                  <span class="o">.</span><span class="na">or</span><span class="o">()</span>
                                  <span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Peter"</span><span class="o">)</span>
                                  <span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="조건">조건</h3>
<p>모든 조건이 모든 데이터 타입을 지원하지는 않습니다.</p>

<ul>
  <li>between()</li>
  <li>greaterThan()</li>
  <li>lessThan()</li>
  <li>greaterThanOrEqualTo()</li>
  <li>lessThanOrEqualTo()</li>
  <li>equalTo()</li>
  <li>notEqualTo()</li>
  <li>contains()</li>
  <li>beginsWith()</li>
  <li>endsWith()</li>
  <li>isNull</li>
  <li>isNotNull()</li>
  <li>isEmpty()</li>
  <li>isNotEmpty()</li>
</ul>

<h3 id="논리-연산자">논리 연산자</h3>
<p>각 조건은 암묵적으로 AND 연산이 지원됩니다. or 연산을 위해서는 명시적으로 or()를 사용해야합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">greaterThan</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>  <span class="c1">// 암묵적인 AND</span>
                            <span class="o">.</span><span class="na">beginGroup</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Peter"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">or</span><span class="o">()</span> <span class="c1">// or() 사용</span>
                                <span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Jo"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">endGroup</span><span class="o">()</span>
                            <span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
</code></pre>
</div>

<p>게다가, not()으로 부정 조건을 만들 수 있습니다. not() 연산자는 하위 조건을 부정하기 위해서는 오직 beginGroup()/endGroup()과 함께 사용할 수 있습니다.</p>

<h3 id="정렬">정렬</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="s">"age"</span><span class="o">);</span> <span class="c1">// 오름차순으로 정렬</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="n">Sort</span><span class="o">.</span><span class="na">DESCENDING</span><span class="o">);</span>

</code></pre>
</div>

<h3 id="자동-갱신-결과">자동 갱신 결과</h3>
<p>RealmResults는 기반 데이터에 의해 라이브로 자동 갱신되는 뷰입니다. 데이터를 수정하면 질의는 다음 루프 이벤트인 RealmResults에 반영됩니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">final</span> <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">puppies</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">lessThan</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
<span class="n">puppies</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="c1">// =&gt; 0</span>

<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kt">void</span> <span class="kd">public</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">createObject</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dog</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Fido"</span><span class="o">);</span>
        <span class="n">dog</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">puppies</span><span class="o">.</span><span class="na">addChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">RealmChangeListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChange</span><span class="o">(</span><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// results와 puppies는 같은 시간에 값이 올라갑니다</span>
      <span class="n">results</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="c1">// =&gt; 1</span>
      <span class="n">puppies</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="c1">// =&gt; 1</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h3 id="집합">집합</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
<span class="kt">long</span>   <span class="n">sum</span>     <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">sum</span><span class="o">(</span><span class="s">"age"</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
<span class="kt">long</span>   <span class="n">min</span>     <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="s">"age"</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
<span class="kt">long</span>   <span class="n">max</span>     <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="s">"age"</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">average</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">average</span><span class="o">(</span><span class="s">"age"</span><span class="o">);</span>

<span class="kt">long</span>   <span class="n">matches</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="반복자">반복자</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">User</span> <span class="n">u</span> <span class="o">:</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ... 객체에 대해 뭔가 합시다 ...</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">results</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="c1">// ... 객체에 대해 뭔가 합시다 ...</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="삭제">삭제</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// 질의의 결과를 얻습니다</span>
<span class="kd">final</span> <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Dog</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAll</span><span class="o">();</span>

<span class="c1">// 데이터에 대한 모든 변경은 트랜잭션에서 이루어져야 합니다</span>
<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 하나 맞는 데이터를 삭제합니다</span>
        <span class="n">results</span><span class="o">.</span><span class="na">deleteFirstFromRealm</span><span class="o">();</span>
        <span class="n">results</span><span class="o">.</span><span class="na">deleteLastFromRealm</span><span class="o">();</span>

        <span class="c1">// 하나의 객체를 삭제합니다</span>
        <span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">dog</span><span class="o">.</span><span class="na">deleteFromRealm</span><span class="o">();</span>

        <span class="c1">// 전체 맞는 데이터를 삭제합니다</span>
        <span class="n">results</span><span class="o">.</span><span class="na">deleteAllFromRealm</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h3 id="비동기-질의">비동기 질의</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">or</span><span class="o">()</span>
                              <span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Peter"</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">findAllAsync</span><span class="o">();</span> <span class="c1">// 비동기</span>
</code></pre>
</div>

<p>질의가 즉시 RealmResults<User>를 반환하는 부분은 일종의 규칙입니다. 만약 REalmResults가 갱신이 완료되었을때 노티를 받기를 원한다면 RealmChangeListener를 등록합니다. 이 리스너는 Realm의 마지막 값이 바뀔 때마다 RealmResults를 갱신합니다.</User></p>

<h4 id="콜백-등록하기">콜백 등록하기</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="n">RealmChangeListener</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealmChangeListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChange</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// 질의과 완료될 때 한번 호출되고 매 업데이트마다 호출됩니다</span>
    <span class="c1">// use the result</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">RealmResults</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findAllAsync</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">addChangeListener</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>메모리릭을 막기 위해 리스너들을 해제하는걸 잊지말아야 합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span> <span class="o">()</span> <span class="o">{</span>
    <span class="n">result</span><span class="o">.</span><span class="na">removeChangeListener</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span> <span class="c1">// 특정 리스너를 제거합니다</span>
    <span class="c1">// or</span>
    <span class="n">result</span><span class="o">.</span><span class="na">removeChangeListeners</span><span class="o">();</span> <span class="c1">// 전체 등록된 리스너들을 제거한다</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="질의가-끝났는지-확인">질의가 끝났는지 확인</h4>
<p>동기적으로 획득한 RealmResults의 isLoaded()를 호출하면 항상 true를 반환</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">())</span> <span class="o">{</span>
  <span class="c1">// 결과는 지금 사용할 수 있습니다</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="강제로-질의를-동기적으로-로딩">강제로 질의를 동기적으로 로딩</h4>
<p>현재 스레드를 블록하고 질의를 다시 동기적으로 합니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">result</span><span class="o">.</span><span class="na">load</span><span class="o">()</span> <span class="c1">// 주의하세요. 이 코드는 현재 스레드를 반환될때까지 멈추게 합니다</span>
</code></pre>
</div>

<h2 id="json">JSON</h2>
<p>문자열, JSONObject InputStream으로 표현된 JSON을 Realm에 직접 RealmObject로 추가하는 것이 가능합니다. Realm은 RealmObject에 정의되지 않는 JSON 프로퍼티들은 무시합니다. Realm.createObjectFromJson()을 이용해서 단일 객체를 추가할 수 있고 Realm.createAllFromJson()를 이용하여 객체들의 리스트를 추가할 수 있습니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// A RealmObject that represents a city</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">City</span> <span class="kd">extends</span> <span class="n">RealmObject</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="c1">// 게터와 세터들이 있습니다 ...</span>
<span class="o">}</span>

<span class="c1">// 문자열을 삽입합니다</span>
<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">createObjectFromJson</span><span class="o">(</span><span class="n">City</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"{ city: \"Copenhagen\", id: 1 }"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="c1">// InputStream을 이용하여 여러 아이템을 삽입합니다</span>
<span class="n">realm</span><span class="o">.</span><span class="na">executeTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">Realm</span><span class="o">.</span><span class="na">Transaction</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Realm</span> <span class="n">realm</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"path_to_file"</span><span class="o">));</span>
            <span class="n">realm</span><span class="o">.</span><span class="na">createAllFromJson</span><span class="o">(</span><span class="n">City</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">is</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<h2 id="안드로이드-프레임워크-스레드를-다루는-전략">안드로이드 프레임워크 스레드를 다루는 전략</h2>

<h3 id="asynctask">AsyncTask</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">class</span> <span class="nc">DownloadOrders</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">Long</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">voids</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 이제 백그라운드 스레드입니다.</span>

        <span class="c1">// Realm을 엽니다.</span>
        <span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// Realm을 사용합니다.</span>
            <span class="n">realm</span><span class="o">.</span><span class="na">createAllFromJson</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">api</span><span class="o">.</span><span class="na">getNewOrders</span><span class="o">());</span>
            <span class="n">Order</span> <span class="n">firstOrder</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findFirst</span><span class="o">();</span>
            <span class="kt">long</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">firstOrder</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span> <span class="c1">// Id of order</span>
            <span class="k">return</span> <span class="n">orderId</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">realm</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">Long</span> <span class="n">orderId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 안드로이드 메인스레드로 돌아왔습니다.</span>
        <span class="c1">// orderId를 가지고 order에 대해 Realm에 질의하거나</span>
        <span class="c1">// 어떤 연산을 수행합시다.</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="intentservice">IntentService</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrdersIntentService</span> <span class="kd">extends</span> <span class="n">IntentService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">OrdersIntentService</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">"OrdersIntentService"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onHandleIntent</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 이제 백그라운드 스레드입니다.</span>

        <span class="c1">// Realm을 엽시다.</span>
        <span class="n">Realm</span> <span class="n">realm</span> <span class="o">=</span> <span class="n">Realm</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
        <span class="c1">// Realm을 사용합니다.</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">createAllFromJson</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">api</span><span class="o">.</span><span class="na">getNewOrders</span><span class="o">());</span>
        <span class="n">Order</span> <span class="n">firstOrder</span> <span class="o">=</span> <span class="n">realm</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findFirst</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">firstOrder</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span> <span class="c1">// order의 아이디</span>
        <span class="n">realm</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/angular2/2017/02/19/Angular2-Component/" data-toggle="tooltip" data-placement="top" title="Angular2 Component">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/android/2017/02/27/AVD-Error/" data-toggle="tooltip" data-placement="top" title="'initial hax sync failed' 라고 뜨면서 AVD 실행되지 않을때">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/byPJW">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/byjw.park">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/jungwoon">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:byjungwoon@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Your/Project/Corporate Name 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    


</body>

</html>
